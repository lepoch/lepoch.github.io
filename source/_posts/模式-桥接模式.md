---
title: 模式-桥接模式
date: 2018-06-15T16:35:00.000Z
tags:
  - 模式
  - 笔记
categories:
  - 模式
---

设计模式之桥接模式
<!-- MORE -->

## 简介
> 将抽象部分与它的实现部分分离，使他们都可以独立地变化。

也就是如果实现系统，可以多维度分类，那就能让他们独立变化，以减少耦合。

**多组合**，**少继承** 的体现。

## 关键点
- 可多维度分类
- 多维度分类可以变化
- 可用聚合表示

## 类图
![](http://www.plantuml.com/plantuml/svg/TP1DJeOm48RtSue9Autf5GpWohqNg31ga_wGTbWXLz0pi23n45v7pl5f2gRmbUKCpyFxTih0qdDlD3mfreJ5CitBnxnyJJ_VdmL0esK8-A0LMTuFyZcmbmrZt5Rhg9p50H3lXWqOqNNavT-NcriOrxzuUb6MsYjjpnvJ7asdoP1bvyzJVg4ehtsTRRnaIjmgoaVZNAXF18Z7GE7LwniBSP_U0I3pID5tGhmVk6p5ZKoMER3EWf0C_-tSBhKas_P6Nm00)

```plantuml
@startuml
Title "桥接模式"

class Client
abstract class Abstraction {
  +{abstract} operation()
}
class refinedAbstraction {
  +operation()
}

abstract class Implementor {
  +{abstract} operationImp()
}

class ConcrateImplementorA {
  +operationImp()
}
class ConcrateImplementorB {
  +operationImp()
}

Client -right--> Abstraction

refinedAbstraction -up--|> Abstraction

ConcrateImplementorA -up--|> Implementor
ConcrateImplementorB -up--|> Implementor

Implementor -left<--o Abstraction
Abstraction -righto--> Implemento


@enduml
```


## 实现
### PHP

#### 定义
##### 抽象者
```PHP7
abstract class Abstraction {
    /**
     * @var Implementor
     */
    protected $implementor;

    public function setImplementor(Implementor $imp) {
        $this->implementor = $imp;
    }
    abstract public function operation();
}

class RefinedAbstraction extends Abstraction {

    public function operation()
    {
        $this->implementor->operationImp();
    }
}
```

##### 实现者
```PHP7
abstract class Implementor {
    abstract public function operationImp();
}
class ConcreteImplementorA extends Implementor {

    public function operationImp()
    {
        echo '具体实现者A', PHP_EOL;
    }
}
class ConcreteImplementorB extends Implementor {

    public function operationImp()
    {
        echo '具体实现者B', PHP_EOL;
    }
}
```

#### 使用
```PHP7
$ab = new RefinedAbstraction();
$ab->setImplementor(new ConcreteImplementorA());
$ab->operation();

$ab->setImplementor(new ConcreteImplementorB());
$ab->operation();
```

#### 结果
```
具体实现者A
具体实现者B

```

## 具体例子 🌰
### 题
画图，存在三种图形，三种颜色
- 正方形、长方形、圆形
- 红、绿、蓝

### 使用继承的方式
#### 图形
![](http://www.plantuml.com/plantuml/svg/utgsTl6pQJkVxbsae5jQeAi0P3plsiRrSkf-BA9FvxIX2t4ztxN86282aULwldi_gi2BoNDH1C1wZ20Y47kWsb34e3fHn62Q3I62GASZD2F449enn000)
```plantuml
@startuml
正方形 -up- 形状
长方形 -up- 形状
圆形 -up- 形状

红3 -up- 圆形
绿3 -up- 圆形
蓝3 -up- 圆形

红2 -up- 长方形
绿2 -up- 长方形
蓝2 -up- 长方形

红1 -up- 正方形
绿1 -up- 正方形
蓝1 -up- 正方形
@enduml
```

#### 颜色
![](http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuNg-Qv62Rcc1hiBBHNDUT6xYUhvxFmh_nUIvA7okPsiNFvksy-dUHSOGSQ02hfTJzsE8FPtJXYg0q6a44GHQXT2948FgH0WWwJI4208TZT2940FfH1LmICrB0VeI0000)
```plantuml
@startuml
红 -up- 颜色
绿 -up- 颜色
蓝 -up- 颜色

正方形3 -up- 蓝
长方形3 -up- 蓝
圆形3 -up- 蓝

正方形2 -up- 绿
长方形2 -up- 绿
圆形2 -up- 绿

正方形1 -up- 红
长方形1 -up- 红
圆形1 -up- 红
@enduml
```

#### 问题
很明显，如果再添加形状或者颜色，那会疯掉。

### 以组合或者聚合的方式
![](http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuNg-Qv62Rcc1hiBBHNDUT6xYUhvxFmh_nUIvA7okPsiNFvksy-bUg3OWutdNDgwNK_TZ4NqwfmrT269XIdvvdgx2yzsJdysR0x8ILGHaAQe8mbPKSOYzcE8Wcp457LBpKe1-1W00)
```plantuml
@startuml
红 -up- 颜色
绿 -up- 颜色
蓝 -up- 颜色

正方形 -up- 形状
长方形 -up- 形状
圆形 -up- 形状

红 -down- 结果
绿 -down- 结果
蓝 -down- 结果
正方形 -down- 结果
长方形 -down- 结果
圆形 -down- 结果
@enduml
```

使用时，把颜色和图形进行组合。
ok，下面咱们来用桥接模式实现这套方案

### 类图
![](http://www.plantuml.com/plantuml/svg/VP71JiGW48RlFCKaNjOql807qxW7x_e48v1T4XRgCEYXzjsjJ6qYaLuWV7mP_Xd6p4XSRa7XMsP2ms02vWolLvmSp0hW3amAYU01pZ_xIWR8ZklXL5SHxbVZ8tbRXVctt0AMyFEqNovgg_zUaEI1eQEyECCOB-7OEdioNKMrRKdUkSqueO_yNm8hRazu9kVYiV8KYkiPQfk2BfFMNuyoTBNttN3fj86hRNSa7rH3DQoc-8ja59hyvSfQfwtUwA8jj_0D)
```plantuml
abstract class Shape {
  # color : Color
  + setColor(Color color) : void
  + {abstract} draw() : void
}
class Square {
  + draw() : void
}
class Rectangle {
  + draw() : void
}
class Circle {
  + draw() : void
}

abstract class Color {
  + {abstract} paint() : void
}
class Red {
  + paint() : void
}
class Green {
  + paint() : void
}
class Blue {
  + paint() : void
}

Square -up--|> Shape
Rectangle -up--|> Shape
Circle -up--|> Shape

Red -up--|> Color
Green -up--|> Color
Blue -up--|> Color

Color -right--o Shape
@enduml
```

### PHP
#### 定义
##### 抽象者
```PHP7
abstract class Shape {
    /**
     * @var Color
     */
    protected $color;
    public function setColor(Color $color) {
        $this->color = $color;
    }
    abstract public function draw() : void;
}
class Square extends Shape {

    public function draw()
    : void
    {
        echo '正方形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
class Rectangle extends Shape {

    public function draw()
    : void
    {
        echo '长方形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
class Circle extends Shape {

    public function draw()
    : void
    {
        echo '圆形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
```
##### 实现者
```PHP7
abstract class Color {
    abstract public function paint() : void;
}
class Red extends Color {

    public function paint()
    : void
    {
        echo '红色';
    }
}
class Green extends Color {

    public function paint()
    : void
    {
        echo '绿色';
    }
}
class Blue extends Color {

    public function paint()
    : void
    {
        echo '蓝色';
    }
}
```
#### 使用
```PHP7
$shape = new Circle();
$shape->setColor(new Red());
$shape->draw();

$shape = new Square();
$shape->setColor(new Green());
$shape->draw();

$shape = new Rectangle();
$shape->setColor(new Blue());
$shape->draw();
```
#### 结果
```
圆形，红色
正方形，绿色
长方形，蓝色

```
