---
title: 模式-桥接模式
date: 2018-06-15T16:35:00.000Z
tags:
  - 模式
  - 笔记
categories:
  - 模式
  - 结构型模式
---

设计模式之桥接模式
<!-- MORE -->

## 简介
> 将抽象部分与它的实现部分分离，使他们都可以独立地变化。

也就是如果实现系统，可以多维度分类，那就能让他们独立变化，以减少耦合。

**多组合**，**少继承** 的体现。

## 关键点
- 可多维度分类
- 多维度分类可以变化
- 可用聚合表示

## 类图
![](http://www.plantuml.com/plantuml/svg/TP1DJeOm48RtSue9Autf5GpWohqNg31ga_wGTbWXLz0pi23n45v7pl5f2gRmbUKCpyFxTih0qdDlD3mfreJ5CitBnxnyJJ_VdmL0esK8-A0LMTuFyZcmbmrZt5Rhg9p50H3lXWqOqNNavT-NcriOrxzuUb6MsYjjpnvJ7asdoP1bvyzJVg4ehtsTRRnaIjmgoaVZNAXF18Z7GE7LwniBSP_U0I3pID5tGhmVk6p5ZKoMER3EWf0C_-tSBhKas_P6Nm00)

## 实现
### PHP

#### 定义
##### 抽象者
```PHP
abstract class Abstraction {
    /**
     * @var Implementor
     */
    protected $implementor;

    public function setImplementor(Implementor $imp) {
        $this->implementor = $imp;
    }
    abstract public function operation();
}

class RefinedAbstraction extends Abstraction {

    public function operation()
    {
        $this->implementor->operationImp();
    }
}
```

##### 实现者
```PHP
abstract class Implementor {
    abstract public function operationImp();
}
class ConcreteImplementorA extends Implementor {

    public function operationImp()
    {
        echo '具体实现者A', PHP_EOL;
    }
}
class ConcreteImplementorB extends Implementor {

    public function operationImp()
    {
        echo '具体实现者B', PHP_EOL;
    }
}
```

#### 使用
```PHP
$ab = new RefinedAbstraction();
$ab->setImplementor(new ConcreteImplementorA());
$ab->operation();

$ab->setImplementor(new ConcreteImplementorB());
$ab->operation();
```

#### 结果
```
具体实现者A
具体实现者B

```

## 具体例子 🌰
### 题
画图，存在三种图形，三种颜色
- 正方形、长方形、圆形
- 红、绿、蓝

### 使用继承的方式
#### 形状
![](http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuGh9BCb9LL1widlfqxsBddTjUx9ZrxC5Ev_FQdc-U_cpplrAN5pFrYv-DcqdK5P1jxH0Lm6YZElbrFrOH9_EQKCNudg-Qv4nH0GYo_LyztvKWHUJvw88WFKOGKGWza2reOX1TQA8mJGRGWI1JaTeHeWXD6E8EQJcfG231G00)

#### 颜色
![](http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuGh9BCb9LL1widlfoqLpNdHkUh9ZrxC5Ev_FQdc-U_cpplrAN5pFTorIq2qjq5M0AE1wldi_2l_5vBaeVAvdQnS_cxRpwTv5nX1ne0AkbrFtOuWzdTE6Ae3GQGGH15g5q8aGW-f4223fD8G80XsDq8aG0-b45N18pKi1XWC0)

#### 问题
很明显，如果再添加形状或者颜色，那会疯掉。

### 以组合或者聚合的方式
![](http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuGh9BCb9LL1widlfyzqjJoTqFEkOzgAXzKNZB23x-QoMPzDsFjtJhyJ5zNpN8WNTqW9TXPUBvhpetCJrVFT-5FwBoNDH-5pFrYu6QTuBrGPaFE_QnlLowduiea_djA49GIrCoI_FqrLuldloitbpG5QYYe0iHHL1s8eg3h4NKnnaCwQWGsfU2Z1i0000)

使用时，把颜色和图形进行组合。
ok，下面咱们来用桥接模式实现这套方案

### 类图
![](http://www.plantuml.com/plantuml/svg/2yaioKbLK7goU-dptIrF9tGywvZseg7rHUCi8Flvh9PdqtO-tTCFP3njtVvax-Jd6tS_dRrFYOihCQcuf2WnkKGXEIUnk5WXE2En85MXcaj1GLaXEJydlqZ1Ii4PH0D5j1MAKql070qm2L6W2LHHbf-P0bPG3JEkLY6bAB5S0ovPomKrlx0qiGXYWJOE9K6foIM9UUav-5KvPnOburA2uIk8SwlHdLYGc9bNWiq1AH2rk1Iu5wMcvk5NufHJcefB1HSq47HB2tHrQ-mWOSu5ypQwECYZ6890rIam8MZyW1s59WPo1PeG5oGiT8ioqpDAT7NpeGOwfEQbbERc0000)

### PHP
#### 定义
##### 抽象者
```PHP
abstract class Shape {
    /**
     * @var Color
     */
    protected $color;
    public function setColor(Color $color) {
        $this->color = $color;
    }
    abstract public function draw() : void;
}
class Square extends Shape {

    public function draw()
    : void
    {
        echo '正方形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
class Rectangle extends Shape {

    public function draw()
    : void
    {
        echo '长方形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
class Circle extends Shape {

    public function draw()
    : void
    {
        echo '圆形，';
        $this->color->paint();
        echo PHP_EOL;
    }
}
```
##### 实现者
```PHP
abstract class Color {
    abstract public function paint() : void;
}
class Red extends Color {

    public function paint()
    : void
    {
        echo '红色';
    }
}
class Green extends Color {

    public function paint()
    : void
    {
        echo '绿色';
    }
}
class Blue extends Color {

    public function paint()
    : void
    {
        echo '蓝色';
    }
}
```
#### 使用
```PHP
$shape = new Circle();
$shape->setColor(new Red());
$shape->draw();

$shape = new Square();
$shape->setColor(new Green());
$shape->draw();

$shape = new Rectangle();
$shape->setColor(new Blue());
$shape->draw();
```
#### 结果
```
圆形，红色
正方形，绿色
长方形，蓝色

```

## 生成图的代码
### 桥接模式
```plantuml
@startuml
Title "桥接模式"

class Client
abstract class Abstraction {
  +{abstract} operation()
}
class refinedAbstraction {
  +operation()
}

abstract class Implementor {
  +{abstract} operationImp()
}

class ConcrateImplementorA {
  +operationImp()
}
class ConcrateImplementorB {
  +operationImp()
}

Client -right--> Abstraction

refinedAbstraction -up--|> Abstraction

ConcrateImplementorA -up--|> Implementor
ConcrateImplementorB -up--|> Implementor

Implementor -left<--o Abstraction
Abstraction -righto--> Implemento


@enduml
```

### 以形状为根的继承
```plantuml
@startuml
Title "以形状为根的继承"

正方形 -up- 形状
长方形 -up- 形状
圆形 -up- 形状

红3 -up- 圆形
绿3 -up- 圆形
蓝3 -up- 圆形

红2 -up- 长方形
绿2 -up- 长方形
蓝2 -up- 长方形

红1 -up- 正方形
绿1 -up- 正方形
蓝1 -up- 正方形
@enduml
```

### 以颜色为根的继承
```plantuml
@startuml
Title "以颜色为根的继承"

红 -up- 颜色
绿 -up- 颜色
蓝 -up- 颜色

正方形3 -up- 蓝
长方形3 -up- 蓝
圆形3 -up- 蓝

正方形2 -up- 绿
长方形2 -up- 绿
圆形2 -up- 绿

正方形1 -up- 红
长方形1 -up- 红
圆形1 -up- 红
@enduml
```

### 以组合或者聚合的方式
```plantuml
@startuml
Title "以组合或者聚合的方式"

红 -up- 颜色
绿 -up- 颜色
蓝 -up- 颜色

正方形 -up- 形状
长方形 -up- 形状
圆形 -up- 形状

红 -down- 结果
绿 -down- 结果
蓝 -down- 结果
正方形 -down- 结果
长方形 -down- 结果
圆形 -down- 结果
@enduml
```

### 以组合或者聚合的方式的具体类图
```plantuml
Title "以组合或者聚合的方式的具体类图"

abstract class Shape {
  # color : Color
  + setColor(Color color) : void
  + {abstract} draw() : void
}
class Square {
  + draw() : void
}
class Rectangle {
  + draw() : void
}
class Circle {
  + draw() : void
}

abstract class Color {
  + {abstract} paint() : void
}
class Red {
  + paint() : void
}
class Green {
  + paint() : void
}
class Blue {
  + paint() : void
}

Square -up--|> Shape
Rectangle -up--|> Shape
Circle -up--|> Shape

Red -up--|> Color
Green -up--|> Color
Blue -up--|> Color

Color -right--o Shape
@enduml
```

## 参考
[设计模式读书笔记—–桥接模式](http://cmsblogs.com/?p=357)
