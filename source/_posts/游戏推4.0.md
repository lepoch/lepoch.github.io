---
title: 游戏推4.0
date: 2017-08-08T17:14:00.000Z
tags:
  - 游戏推
---

游戏推4.0


<!-- MORE -->
## 总  
### Request 接受参数  
- `$request->input()  
    - 使用 request()  
- intval($request->input('page')) ? intval($request->input('page')) : 1;  
    - 使用 request('page', 1);    
  
### 调用libs方法  
- 一律使用静态调用，例如 CombineAlbum::getWonderfulCombineAlbumList()    
  
### 传参  
- 尽量使用严格模式  
    - function ttt(int $a)   表示$a为int    
- 创建、搜索等方法，不要出现$data等其他地方没法使用传参    
    - 简单的修改成直接传多个参数  
    - 复杂的创建 entity 类，传入实例  
  
  
### 函数返回  
- 返回值尽量用严格模式  
    - function ttt() : string 表示返回值是string  
- 有异常的传参，可直接抛出异常  
  
  
### phpstorm 提示  
- 全部 warning级提示，都须按照提示修改  
- 格式化代码  
  
  
### 注释  
- 类注释位置，别放最上  
- 函数注释使用 `/** **/`，须注明时间、作者  
- 删除无用注释  
  
### 缓存  
- get, set 使用laravel写法，参见Comment::getInfo  
  
  
### Model  
- 一个model一张表  
- 使用 self:: 代替 DB::，除非特别复杂的sql  
  
  
## Controller  
### CombineAlbumController - ql  
### CommentController - jl      1
- 出现多次的相同代码块  
```  
$mark_type = [   'game'=>Comment::TYPE_GAME,'collection'=>Comment::TYPE_COLLECTION,'comment'=>Comment::TYPE_COMMENT ];  
```  
-   
#### addComment  
- $data['extra'] = \GuzzleHttp\json_encode($extra);  
    - 直接用json_encode  
  
  
#### CommentFollowStatus  
- explode(',', $ids)  
    - 使用 Comment::getId  
  
### ComplainController - jl         1  
#### submsg  
- app('Complain')->addComplain($data)  
  
### FindController  - hl            1  
### FollowController - ql  
### GameController - ql  
### PushController - hl             1  
### RankController - hl             1  
### SearchController - hl           1  
- searchCombine  
    - line 117 ，使用 imgUrl()  
  
  
### UserController  - ql  
- 成段的相同代码  
```  
$userInfo[$k]['absId'] = @$userInfoFlag['id'];  
$userInfo[$k]['abstitle'] = @$userInfoFlag['sina_weibo_name'];  
$userInfo[$k]['absImage'] = @$userInfoFlag['sina_weibo_photo'];  
$userInfo[$k]['introduction'] = @$userInfoFlag['introduction'];  
```  
  
## Libs  
### 各种Util - zm  
### ChineseRateCheck, IosTopGames, GooglePlayScraper, IosTopUrl等  
- 类注释  
- 方法注释，作者、时间  
  
### CategoryTags - ql  
### CombineAlbum - ql  
#### getRedisWonderfulCombineAlbumList   
    - 这种封装是什么鬼  
    - 参考 《总.缓存》  
  
  
### Comment - jl            1
- 各种explode absId  
    - 如果之后要改变加一个逻辑，那得改多少地方。  
    - 修改成$this->getId(), $this->getType(), $this->getAbsId() 等  
- \GuzzleHttp\json_encode  
  
  
#### getCommentByWhere  
#### getCommentListOfUser  
- game info 的并发获取  
  
### Find - hl                   1  
- 缓存  
- 总体挺好  
  
### Follow  - ql
- _follow， follow   
    - 这命名什么鬼  
- 相同代码块  
```  
if($lists){  
    foreach($lists as $k=>$v){  
        $list[$k] = $v['mark'];//转换给不需要详细信息的接口 return;  
    }  
}  
```  
    - 可封装，传入数组，和key，直接获取yarData数组  
  
  
####deleteFollowRelationshipOneCache  
    - 健壮性太差，一旦其他地方有变动，这地方就得错  
    - 建议使用hash，或者用类似 getXXXChacheKey() 获取缓存key  
  
### Game    - ql  
- 相同代码块  
    - 同 Follow.相同代码块  
- 缓存的get,set封装  
    - 可封装getCacheKey  
    - 不必要封装get数据，set数据，其他地方也用不到  
  
#### **获取详情**  
- getInfo，存储后端用的元数据  
- getFrontInfo，存储前端格式化的数据  
- 其他地方用不到的不需要再加缓存，如   
    - getGameApkStoreInfo  
    - getPlatformGameInfo  
  
#### getFilterGameList  
- 可使用 remember   
  
### Push    - hl                    1  
### PushMessage - hl                1  
### Rank - hl                       1  
### Search  - hl                    1  
### Rank    - hl                    1  
### Setting - jl                    
### User    - ql        
- 都没有level，怎么还有代码  
- 也有跟Game同样的缓存使用问题  
  
### UserMessage - hl                1  
  
## Model  
### FindModel   - hl                1  
### FollowModel - ql  
### GameModel   - ql  
### PushModel   - hl                1  
### RecommendModel - hl             1  
#### getModelKeyWordCombineAlbumList  
- 拆分  
  
### TagsInfoModel - ql  
### UserModel   - ql  
