---
title: 模式-策略模式
date: 2018-07-31T16:35:00.000Z
tags:
  - 模式
  - 笔记
categories:
  - 模式
  - 行为型模式
---

设计模式之策略模式

<!-- MORE -->

## 简介
> 策略模式定义了算法族，分别分装起来，让他们可以相互替换，此模式让算法的变化独立于使用算法的客户。

## 关键点
- 易于变化的部分
- 组合

## 具体例子 🌰
### 题

- 有个游戏有各种鸭子，有游泳、呱呱叫的行为
- 各种鸭子包括
  - 绿头鸭
  - 红头鸭
  - 橡皮鸭
  - 超鸭
- 有些鸭子会飞
- 有些鸭子会叫
- 鸭子都会游泳

## 类图
![](http://www.plantuml.com/plantuml/png/VL9Dwn917BxFfnWy6R7hDn2943eOL0VFu-weYwEkkpE5g51485HOXpfuABI28XI4A5-Aliokgz-Y-S_kZBERBmpuUtcUv_Uolv9FaKTPcm3gK89XBbgyZzvzsN-TXRydEU0YguKQF1mkv_lnhnmS002XHP3lmxlCQd4VyfzH9lqxk8aUErqFrazsd7p0k8fAztGF2CHj7rDD8S_jUsLTvvQ2fRJomkDGgQc1JJFXF77Q-OHlExvBK5-wTQ9C8I2SqMd02Y84URQQKrU0XGACTd_3pp-EwuMWITP3R3SnkiBQpi-nMAs6lOka_RTPD5rcIO-OUuLp-Fb24W3KXp6COV7c7q2zMJsgcj62gfYASLrr7yTF7mwpL_m5wsro9Kw7Og-EB0pZxpbGMyykckUh3crMdKx3rs5Y3AwS6fedxdUhgFyVCDWz3JRZOFlo-FnFi7uTFflAAhg-mLpJ71P5Im0gjLHufDtzszNDcto_C9gymC6LEnAOD48q76kdlsYFONGM-sR5NmfROHHVabQx23OVqxiGZ6HQOOirn7MpOLKYc-5AyIN42vEEJ0DGmXsRjSa_)

## 实现
### GO

#### 定义
##### 客户
```GO
type DuckIF interface {
	Fly()
	Quack()
	Swim()
	Display()
}

type Duck struct {
	flyBehavior   FlyIF
	quackBehavior QuackIF
}

func (d *Duck) SetFlyBehavior(flyBehavior FlyIF) {
	d.flyBehavior = flyBehavior
}
func (d *Duck) SetQuackBehavior(quackBehavior QuackIF) {
	d.quackBehavior = quackBehavior
}

func (d Duck) Swim() {
	fmt.Println("游泳")
}
func (d Duck) Fly() {
	d.flyBehavior.Fly()
}
func (d Duck) Quack() {
	d.quackBehavior.Quack()
}

type MallardDuck struct {
	Duck
}

func (d MallardDuck) Display() {
	fmt.Println("绿头鸭")
}

type RedheadDuck struct {
	Duck
}

func (d RedheadDuck) Display() {
	fmt.Println("红头鸭")
}

type RubberDuck struct {
	Duck
}

func (d RubberDuck) Display() {
	fmt.Println("橡皮鸭")
}

type SuperDuck struct {
	Duck
}

func (d SuperDuck) Display() {
	fmt.Println("超级鸭")
}
```

##### 飞行行为
```GO
type FlyIF interface {
	Fly()
}

type FlyWithWings struct {
}

func (f FlyWithWings) Fly() {
	fmt.Println("飞行")
}

type FlyNoWay struct {
}

func (f FlyNoWay) Fly() {
	fmt.Println("啥事也不做，不会飞")
}
```

##### 呱呱叫行为
```GO
type QuackIF interface {
	Quack()
}

type Quack struct {
}

func (q Quack) Quack() {
	fmt.Println("呱呱")
}

type Squeak struct {
}

func (q Squeak) Quack() {
	fmt.Println("吱吱")
}

type MuteQuack struct {
}

func (q MuteQuack) Quack() {
	fmt.Println("静音，不会叫")
}
```

#### 使用
```GO
super := SuperDuck{}
super.SetQuackBehavior(MuteQuack{})
super.SetFlyBehavior(FlyWithWings{})
super.Display()
super.Quack()
super.Fly()

fmt.Println()

rubber := RubberDuck{}
rubber.SetQuackBehavior(Squeak{})
rubber.SetFlyBehavior(FlyNoWay{})
rubber.Display()
rubber.Quack()
rubber.Fly()
```

#### 结果
```
超级鸭
静音，不会叫
飞行

橡皮鸭
吱吱
啥事也不做，不会飞
```

## 生成图的代码
### 策略模式
```plantuml
@startuml
title "策略模式"
package "客户" {

  class Duck {
    -FlyBehavior flyBehavior
    -QuackBehavior quackBehavior

    +setFlyBehavior(FlyIF flyBehavior)
    +setQuackBehavior(QuackIF quackBehavior)
    ..
    +swim()
    +display()
    +fly()
    +quack()
  }

  class MallardDuck {
    +display() // 绿头鸭
  }
  class RedheadDuck {
    +display() // 红头鸭
  }
  class RubberDuck {
    +display() // 橡皮鸭
  }
  class SuperDuck {
    +display() // 超鸭
  }

  MallardDuck--|>Duck
  RedheadDuck--|>Duck
  RubberDuck--|>Duck
  SuperDuck--|>Duck
}

package "飞行行为" {

  interface FlyIF {
    +fly()
  }

  class FlyWithWings {
    +fly() // 飞
  }
  class flyNoWay {
    +fly() // 什么事都不做
  }

  FlyWithWings-up..|>FlyIF
  flyNoWay-up..|>FlyIF
}
package "呱呱叫行为" {

  interface QuackIF {
    +quack()
  }

  class Quack {
    +quack() // 呱呱
  }
  class Squeak {
    +quack() // 吱吱
  }
  class MuteQuack {
    +quack() // 什么事也不做
  }

  Quack-up..|>QuackIF
  Squeak-up..|>QuackIF
  MuteQuack-up..|>QuackIF
}

Duck-->FlyIF
Duck-->QuackIF


@enduml
```
